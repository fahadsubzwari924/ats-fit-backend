# Makefile Commands Reference

This document provides detailed information about all available Makefile commands for the ATS-Fit Backend project.

## üöÄ **Quick Start Commands**

| Command       | Description                   | Use Case                         |
| ------------- | ----------------------------- | -------------------------------- |
| `make help`   | Show all available commands   | When you need to see all options |
| `make dev`    | Start development environment | Daily development work           |
| `make stop`   | Stop all services             | End of work session              |
| `make status` | Show service status           | Check what's running             |

## üîß **Development Commands**

### **Environment Management**

- `make dev` - Start development environment (PostgreSQL, Redis, pgAdmin, Redis Commander)
- `make prod` - Start production environment
- `make stop` - Stop all services
- `make restart` - Restart development environment
- `make status` - Show service status
- `make health` - Check if all services are healthy

### **Build Commands**

- `make build` - Build all Docker images
- `make rebuild` - Rebuild all images from scratch (no cache)

### **Database Commands**

- `make migrate` - Run database migrations
- `make migrate-generate` - Generate a new migration (interactive)
- `make migrate-revert` - Revert the last migration
- `make db-reset` - Reset database completely (clean + migrate)

### **Logging & Debugging**

- `make logs` - Show logs from all services
- `make logs-postgres` - Show PostgreSQL logs only
- `make logs-redis` - Show Redis logs only
- `make logs-pgadmin` - Show pgAdmin logs only

### **Database Access**

- `make shell-postgres` - Open PostgreSQL shell
- `make shell-redis` - Open Redis shell

### **Testing**

- `make test` - Run tests
- `make test-e2e` - Run end-to-end tests
- `make test-cov` - Run tests with coverage

### **Maintenance**

- `make clean` - Remove all containers, volumes, and images
- `make clean-all` - Deep clean everything including build cache
- `make install` - Install dependencies

### **Backup & Restore**

- `make backup-db` - Backup database to backups/ directory
- `make restore-db FILE=backup.sql` - Restore database from backup file

## üåê **Service URLs**

After running `make dev`, these services will be available:

| Service             | URL                   | Credentials                     |
| ------------------- | --------------------- | ------------------------------- |
| **PostgreSQL**      | localhost:5433        | postgres / PLACEHOLDER_PASSWORD |
| **pgAdmin**         | http://localhost:5050 | admin@admin.com / admin         |
| **Redis**           | localhost:6379        | -                               |
| **Redis Commander** | http://localhost:8081 | -                               |

## üìù **Common Workflows**

### **Starting Development**

```bash
make dev          # Start infrastructure
make migrate      # Run migrations
npm run start:dev # Start your app
```

### **Checking Status**

```bash
make status       # Check Docker services
make health       # Verify connectivity
make logs         # See what's happening
```

### **Database Work**

```bash
make shell-postgres           # Open database shell
make migrate-generate         # Create new migration
make migrate                  # Apply migrations
make backup-db               # Backup before changes
```

### **Troubleshooting**

```bash
make logs-postgres           # Check PostgreSQL issues
make logs-pgadmin           # Check pgAdmin issues
make restart                # Restart everything
make clean && make dev      # Nuclear option
```

### **End of Day**

```bash
make stop                   # Stop all services
make backup-db             # Backup your work (optional)
```

## üêõ **Troubleshooting**

### **Port Conflicts**

If you get port conflicts:

```bash
make stop
# Check what's using the ports
lsof -i :5433
lsof -i :5050
# Kill processes if needed, then
make dev
```

### **Database Issues**

```bash
# Reset everything
make clean
make dev
make migrate
```

### **Service Not Starting**

```bash
# Check logs
make logs
# Or specific service
make logs-postgres
```

### **Out of Disk Space**

```bash
# Clean up Docker resources
make clean-all
docker system prune -af --volumes
```

## üîÑ **Migration from run.sh**

If you're currently using `run.sh`, here's the mapping:

| Old Command       | New Command   |
| ----------------- | ------------- |
| `./run.sh dev`    | `make dev`    |
| `./run.sh prod`   | `make prod`   |
| `./run.sh stop`   | `make stop`   |
| `./run.sh status` | `make status` |
| `./run.sh build`  | `make build`  |

## ‚öôÔ∏è **Advanced Usage**

### **Custom Database Restore**

```bash
# Restore from specific backup
make restore-db FILE=backups/ats_fit_20231201_120000.sql
```

### **Generate Migration with Custom Name**

```bash
# Will prompt for migration name
make migrate-generate
```

### **Selective Service Logs**

```bash
# Focus on specific service issues
make logs-postgres | grep ERROR
make logs-pgadmin | tail -50
```

## üìö **Additional Resources**

- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [NestJS Documentation](https://docs.nestjs.com/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Redis Documentation](https://redis.io/documentation)

---

**Pro Tip**: Use `make help` anytime to see all available commands with descriptions!
